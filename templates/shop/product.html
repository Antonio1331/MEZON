{% extends "base.html" %}
{% load i18n static %}

{% block title %}
  {{ product.name }} ‚Äî {% trans "–∫—É–ø–∏—Ç—å" %} | {% trans "MEZON Market" %}
{% endblock %}

{% block meta_description %}
  {% if product.description %}
    {{ product.description|striptags|truncatechars:160 }}
  {% else %}
    {% trans "–ö—É–ø–∏—Ç—å" %} {{ product.name }}. {% trans "–î–æ—Å—Ç–∞–≤–∫–∞ ‚Äî MEZON Market." %}
  {% endif %}
{% endblock %}

{% block og_type %}product{% endblock %}

{% block og_image %}
  {% if product.image %}
    https://mezon-market.uz{{ product.image.url }}
  {% else %}
    https://mezon-market.uz{% static 'img/logo.jpg' %}
  {% endif %}
{% endblock %}

{% block content %}
<div class="glass p-4 sm:p-6 rounded-3xl">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- IMAGE -->
    <div class="relative">
      {% if product.image %}
        <img src="{{ product.image.url }}" decoding="async"
             class="w-full h-64 sm:h-80 object-cover rounded-3xl"
             alt="{{ product.name }}">
      {% else %}
        <div class="w-full h-64 sm:h-80 rounded-3xl bg-white/5"></div>
      {% endif %}

      <!-- Badges -->
      <div class="absolute left-3 top-3 flex flex-wrap gap-2">
        {% if product.discount_percent|default:0 >= 35 %}
          <span class="sale-badge">üî• {% trans "–°—É–ø–µ—Ä –∞–∫—Ü–∏—è" %}</span>
        {% elif product.discount_percent|default:0 > 0 or product.old_price %}
          <span class="sale-badge">‚ö° {% trans "–ê–∫—Ü–∏—è" %}</span>
        {% endif %}
      </div>
    </div>

    <!-- INFO -->
    <div>
      <div class="text-2xl sm:text-3xl font-extrabold leading-snug">{{ product.name }}</div>

      {% if product.description %}
        <div class="mt-2 text-white/70 text-sm leading-relaxed">
          {{ product.description }}
        </div>
      {% endif %}

      <!-- Price/Stock -->
      <div class="mt-5 flex items-end justify-between gap-3">
        <div>
          {% if product.discount_percent|default:0 > 0 %}
            <div class="text-sm line-through text-white/40">{{ product.price }} {% trans "—Å—É–º" %}</div>
            <div class="text-3xl font-extrabold">{{ product.final_price }} {% trans "—Å—É–º" %}</div>
            <div class="text-xs text-green-200">-{{ product.discount_percent }}%</div>
          {% elif product.old_price and product.old_price > product.price %}
            <div class="text-sm line-through text-white/40">{{ product.old_price }} {% trans "—Å—É–º" %}</div>
            <div class="text-3xl font-extrabold">{{ product.price }} {% trans "—Å—É–º" %}</div>
          {% else %}
            <div class="text-3xl font-extrabold">{{ product.price }} {% trans "—Å—É–º" %}</div>
          {% endif %}
        </div>

        {% if product.stock|default:0 > 0 %}
          <div class="text-sm text-white/70">{% trans "–í –Ω–∞–ª–∏—á–∏–∏" %}: <b>{{ product.stock }}</b></div>
        {% else %}
          <div class="text-sm text-white/70"><b>{% trans "–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" %}</b></div>
        {% endif %}
      </div>

      <!-- Add to cart -->
      <div class="mt-4">
        {% if product.stock|default:0 > 0 %}
          <button type="button"
                  class="btn-brand w-full text-center py-3 rounded-2xl text-base active:scale-[0.99] transition"
                  data-add-to-cart
                  data-url="{% url 'add_to_cart' product.id %}"
                  data-name="{{ product.name|escapejs }}">
            {% trans "–í –∫–æ—Ä–∑–∏–Ω—É" %}
          </button>
        {% else %}
          <button type="button"
                  class="w-full text-center py-3 rounded-2xl text-base bg-white/10 text-white/50 cursor-not-allowed"
                  disabled>
            {% trans "–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" %}
          </button>
        {% endif %}
      </div>


      <div class="mt-3 text-white/60 text-xs">
        {% trans "–ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É –Ω–µ–ª—å–∑—è." %}
      </div>

      <!-- Delivery hint (UI only) -->
      <div class="mt-4 text-white/60 text-xs space-y-1">
        <div>‚è∞ {% trans "–î–æ—Å—Ç–∞–≤–∫–∞" %}: <b>10:00‚Äì22:00</b></div>
        <div>üßæ {% trans "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞" %}: <b>50 000</b> {% trans "—Å—É–º" %}</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
