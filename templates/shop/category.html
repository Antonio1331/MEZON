{% extends "base.html" %}
{% load i18n %}

{% block title %}
  {{ category.name }} ‚Äî {% trans "–∫–∞—Ç–µ–≥–æ—Ä–∏—è" %} | {% trans "MEZON Market" %}
{% endblock %}

{% block meta_description %}
  {% trans "–ö—É–ø–∏—Ç—å –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" %} ¬´{{ category.name }}¬ª. {% trans "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ –æ–Ω–ª–∞–π–Ω ‚Äî –±—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞." %}
{% endblock %}

{% block hero %}
<div class="glass p-4 sm:p-6 rounded-3xl">
  <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between">
    <div>
      <div class="text-2xl sm:text-3xl font-extrabold leading-tight">{{ category.name }}</div>
      <div class="text-white/70 mt-1">{% trans "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤ –∫–æ—Ä–∑–∏–Ω—É." %}</div>
    </div>

    <a href="{% url 'home' %}" class="badge-soft inline-flex items-center justify-center px-4 py-2 rounded-2xl">
      ‚Üê {% trans "–ù–∞ –≥–ª–∞–≤–Ω—É—é" %}
    </a>
  </div>
</div>
{% endblock %}

{% block content %}
{% if promo_products %}
  <div class="glass p-4 rounded-3xl mb-4 flex items-center justify-between gap-3">
    <div class="text-xl sm:text-2xl font-extrabold">{% trans "–ê–∫—Ü–∏–∏" %}</div>
    <div class="sale-badge">
      <svg class="icon-bolt" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M13 2 3 14h7l-1 8 12-14h-7l-1-6Z"/>
      </svg>
      {% trans "–°–∫–∏–¥–∫–∏" %}
    </div>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
    {% for product in promo_products %}
      <div class="card p-4">
        <a href="{% url 'product_detail' product.id %}" class="block">
          <div class="relative">
            {% if product.image %}
              <img src="{{ product.image.url }}" alt="{{ product.name }}"
                   class="w-full h-44 sm:h-48 object-cover rounded-2xl">
            {% else %}
              <div class="w-full h-44 sm:h-48 rounded-2xl bg-white/5"></div>
            {% endif %}

            <div class="absolute left-2 top-2 flex flex-wrap gap-2">
              {% if product.discount_percent|default:0 >= 35 %}
                <span class="sale-badge">üî• {% trans "–°—É–ø–µ—Ä –∞–∫—Ü–∏—è" %}</span>
              {% elif product.discount_percent|default:0 > 0 or product.old_price %}
                <span class="sale-badge">‚ö° {% trans "–ê–∫—Ü–∏—è" %}</span>
              {% endif %}
            </div>
          </div>

          <div class="mt-3">
            <div class="font-extrabold leading-snug line-clamp-2">{{ product.name }}</div>

            <div class="mt-2 flex items-end justify-between gap-3">
              <div>
                {% if product.discount_percent|default:0 > 0 %}
                  <div class="text-xs line-through text-white/40">{{ product.price }} {% trans "—Å—É–º" %}</div>
                  <div class="text-lg font-extrabold">{{ product.final_price }} {% trans "—Å—É–º" %}</div>
                  <div class="text-[11px] text-green-200">-{{ product.discount_percent }}%</div>
                {% elif product.old_price and product.old_price > product.price %}
                  <div class="text-xs line-through text-white/40">{{ product.old_price }} {% trans "—Å—É–º" %}</div>
                  <div class="text-lg font-extrabold">{{ product.price }} {% trans "—Å—É–º" %}</div>
                {% else %}
                  <div class="text-lg font-extrabold">{{ product.price }} {% trans "—Å—É–º" %}</div>
                {% endif %}
              </div>

              {% if product.stock|default:0 > 0 %}
                <div class="text-xs text-white/70">{% trans "–í –Ω–∞–ª–∏—á–∏–∏" %}: <b>{{ product.stock }}</b></div>
              {% else %}
                <div class="text-xs text-white/70"><b>{% trans "–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" %}</b></div>
              {% endif %}
            </div>
          </div>
        </a>

        <div class="mt-3">
          {% if product.stock|default:0 > 0 %}
            <button type="button"
                    class="btn-brand w-full py-2.5 rounded-2xl text-sm active:scale-[0.99] transition"
                    data-add-to-cart
                    data-url="{% url 'add_to_cart' product.id %}"
                    data-name="{{ product.name|escapejs }}">
              {% trans "–í –∫–æ—Ä–∑–∏–Ω—É" %}
            </button>
          {% else %}
            <button type="button"
                    class="w-full py-2.5 rounded-2xl text-sm bg-white/10 text-white/50 cursor-not-allowed"
                    disabled>
              {% trans "–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" %}
            </button>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
  {% for product in products %}
    <div class="card p-4">
      <a href="{% url 'product_detail' product.id %}" class="block">
        <div class="relative">
          {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}"
                 class="w-full h-44 sm:h-48 object-cover rounded-2xl">
          {% else %}
            <div class="w-full h-44 sm:h-48 rounded-2xl bg-white/5"></div>
          {% endif %}

          <div class="absolute left-2 top-2 flex flex-wrap gap-2">
            {% if product.discount_percent|default:0 >= 35 %}
              <span class="sale-badge">üî• {% trans "–°—É–ø–µ—Ä –∞–∫—Ü–∏—è" %}</span>
            {% elif product.discount_percent|default:0 > 0 or product.old_price %}
              <span class="sale-badge">‚ö° {% trans "–ê–∫—Ü–∏—è" %}</span>
            {% endif %}
          </div>
        </div>

        <div class="mt-3">
          <div class="font-extrabold leading-snug line-clamp-2">{{ product.name }}</div>

          <div class="mt-2 flex items-end justify-between gap-3">
            <div>
              {% if product.discount_percent|default:0 > 0 %}
                <div class="text-xs line-through text-white/40">{{ product.price }} {% trans "—Å—É–º" %}</div>
                <div class="text-lg font-extrabold">{{ product.final_price }} {% trans "—Å—É–º" %}</div>
                <div class="text-[11px] text-green-200">-{{ product.discount_percent }}%</div>
              {% elif product.old_price and product.old_price > product.price %}
                <div class="text-xs line-through text-white/40">{{ product.old_price }} {% trans "—Å—É–º" %}</div>
                <div class="text-lg font-extrabold">{{ product.price }} {% trans "—Å—É–º" %}</div>
              {% else %}
                <div class="text-lg font-extrabold">{{ product.price }} {% trans "—Å—É–º" %}</div>
              {% endif %}
            </div>

            {% if product.stock|default:0 > 0 %}
              <div class="text-xs text-white/70">{% trans "–í –Ω–∞–ª–∏—á–∏–∏" %}: <b>{{ product.stock }}</b></div>
            {% else %}
              <div class="text-xs text-white/70"><b>{% trans "–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" %}</b></div>
            {% endif %}
          </div>
        </div>
      </a>

      <div class="mt-3">
        {% if product.stock|default:0 > 0 %}
          <button type="button"
                  class="btn-brand w-full py-2.5 rounded-2xl text-sm active:scale-[0.99] transition"
                  data-add-to-cart
                  data-url="{% url 'add_to_cart' product.id %}"
                  data-name="{{ product.name|escapejs }}">
            {% trans "–í –∫–æ—Ä–∑–∏–Ω—É" %}
          </button>
        {% else %}
          <button type="button"
                  class="w-full py-2.5 rounded-2xl text-sm bg-white/10 text-white/50 cursor-not-allowed"
                  disabled>
            {% trans "–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" %}
          </button>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <div class="glass p-6 rounded-3xl text-white/70">
      {% trans "–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤." %}
    </div>
  {% endfor %}
</div>
{% endblock %}
