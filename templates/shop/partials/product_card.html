{% load i18n %}

<div class="glass rounded-2xl overflow-hidden flex flex-col h-full relative group">

  <!-- –ú–µ—Ç–∫–∞ –∞–∫—Ü–∏–∏ -->
  {% if is_promo or product.is_on_sale or product.old_price %}
    <div class="absolute top-3 left-3 z-20 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg transform -rotate-2">
      {% trans "–í –∞–∫—Ü–∏–∏" %}
    </div>
  {% endif %}

  <!-- –§–æ—Ç–æ -->
  <div class="relative pt-[100%] bg-gradient-to-br from-gray-900/40 to-black/50 overflow-hidden">
    {% if product.image %}
      <img src="{{ product.image.url }}" alt="{{ product.name|escape }}"
           class="absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
           loading="lazy">
    {% else %}
      <div class="absolute inset-0 flex items-center justify-center text-white/30 text-6xl sm:text-8xl">üõí</div>
    {% endif %}
  </div>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="p-4 sm:p-5 flex flex-col flex-grow">
    <h3 class="font-semibold text-base sm:text-lg md:text-xl line-clamp-2 mb-3 leading-tight">
      {{ product.name }}
    </h3>

    <!-- –¶–µ–Ω–∞ –∏ –Ω–∞–ª–∏—á–∏–µ -->
    <div class="mt-auto space-y-2">
      {% if product.old_price and product.old_price > product.price %}
        <div class="flex items-baseline gap-3 flex-wrap">
          <span class="text-2xl sm:text-2.5xl md:text-3xl font-extrabold text-red-400 tracking-tight">
            {{ product.price|floatformat:0 }} <small class="text-lg">—Å—É–º</small>
          </span>
          <span class="text-sm sm:text-base text-gray-400 line-through decoration-red-500/70">
            {{ product.old_price|floatformat:0 }} —Å—É–º
          </span>
        </div>
      {% else %}
        <div class="text-2xl sm:text-2.5xl md:text-3xl font-extrabold">
          {{ product.price|floatformat:0 }} <small class="text-lg">—Å—É–º</small>
        </div>
      {% endif %}

      <div class="text-xs sm:text-sm font-medium {% if product.stock > 0 %}text-emerald-400{% else %}text-red-500{% endif %}">
        {% if product.stock > 0 %}
          {% trans "–í –Ω–∞–ª–∏—á–∏–∏" %}: {{ product.stock }}
        {% else %}
          {% trans "–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" %}
        {% endif %}
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É (AJAX) -->
    {% if product.stock > 0 %}
      <button type="button"
              class="mt-4 sm:mt-5 w-full py-3.5 px-5 rounded-xl font-medium text-white
                     bg-gradient-to-r from-green-600 to-emerald-600
                     hover:from-green-500 hover:to-emerald-500
                     active:from-green-700 active:to-emerald-700
                     transition-all duration-200 shadow-md hover:shadow-lg hover:shadow-green-800/30
                     active:scale-[0.98] flex items-center justify-center gap-2 disabled:opacity-60 disabled:cursor-not-allowed"
              data-product-id="{{ product.id }}"
              data-product-name="{{ product.name|escapejs }}"
              data-add-to-cart>
        <span>{% trans "–í –∫–æ—Ä–∑–∏–Ω—É" %}</span>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
        </svg>
      </button>
    {% else %}
      <button disabled class="mt-4 sm:mt-5 w-full py-3.5 px-5 rounded-xl font-medium text-white/60 bg-gray-700/60 cursor-not-allowed">
        {% trans "–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏" %}
      </button>
    {% endif %}
  </div>
</div>